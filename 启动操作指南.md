# 房源信息网站启动操作指南

## 项目概述
这是一个基于Flask + MySQL的房源信息展示网站，包含房源搜索、收藏、浏览记录、地图搜索等功能。

## 环境要求
- Python 3.9+
- Conda环境管理器
- MySQL数据库

## 启动步骤

### 第一步：检查conda环境
```bash
# 查看所有conda环境
conda info --envs

# 确认mysql环境存在
# 应该能看到mysql环境：E:\conda\envs\mysql
```

### 第二步：启动MySQL服务器
```bash
# 激活mysql conda环境
conda activate mysql

# 检查MySQL安装
which mysql
mysqld --version

# 创建数据目录（如果不存在）
mkdir -p E:/conda/envs/mysql/Library/data

# 初始化MySQL数据库（仅首次需要）
mysqld --initialize-insecure --datadir=E:/conda/envs/mysql/Library/data

# 启动MySQL服务器（在后台运行）
mysqld --console &
```

**重要提示**：MySQL服务器启动后会显示类似信息：
```
MySQL Server - start.
InnoDB initialization has started.
InnoDB initialization has ended.
ready for connections. Version: '9.3.0'  socket: ''  port: 3306
```

### 第三步：创建和配置数据库
```bash
# 连接MySQL并创建数据库
mysql -u root -e "CREATE DATABASE IF NOT EXISTS house;"

# 导入房源数据（约113,318条记录）
mysql -u root -D house < house.sql

# 添加经纬度字段（重要！）
mysql -u root -D house < add_location_fields.sql

# 验证数据导入
mysql -u root -D house -e "SELECT COUNT(*) FROM house_info;"
```

### 第四步：启动Flask应用
```bash
# 确保在项目目录中
cd E:\Web实践\0920

# 激活mysql环境（如果未激活）
conda activate mysql

# 启动Flask应用
python app.py
```

**成功启动后会显示**：
```
数据库表创建成功
* Serving Flask app 'app'
* Debug mode: on
* Running on all addresses (0.0.0.0)
* Running on http://127.0.0.1:5000
* Running on http://[你的IP地址]:5000
Press CTRL+C to quit
```

## 访问网站
- 本地访问：http://127.0.0.1:5000
- 局域网访问：http://[显示的IP地址]:5000

## 常见问题解决

### 问题1：MySQL连接被拒绝
**错误信息**：`ConnectionRefusedError: [WinError 10061] 由于目标计算机积极拒绝，无法连接`

**解决方法**：
1. 检查MySQL服务是否启动：`mysqld --console`
2. 确认端口3306未被占用

### 问题2：缺少latitude/longitude字段
**错误信息**：`Unknown column 'house_info.latitude' in 'field list'`

**解决方法**：
```bash
# 添加缺失的字段
mysql -u root -D house < add_location_fields.sql

# 重启Flask应用
# 先按Ctrl+C停止，然后重新运行 python app.py
```

### 问题3：网站显示但无房源数据
**原因**：数据库为空

**解决方法**：
```bash
# 检查数据量
mysql -u root -D house -e "SELECT COUNT(*) FROM house_info;"

# 如果返回0，重新导入数据
mysql -u root -D house < house.sql
```

### 问题4：中文显示乱码
**解决方法**：
```bash
# 设置数据库字符集
mysql -u root -D house -e "ALTER DATABASE house CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"
```

## 一键启动脚本

创建 `start.bat` 文件（Windows）：
```batch
@echo off
echo 启动MySQL服务器...
start /B mysqld --console

echo 等待MySQL启动...
timeout /t 5 /nobreak > nul

echo 启动Flask应用...
conda activate mysql
python app.py
pause
```

创建 `start.sh` 文件（Linux/Mac）：
```bash
#!/bin/bash
echo "启动MySQL服务器..."
mysqld --console &

echo "等待MySQL启动..."
sleep 5

echo "启动Flask应用..."
source activate mysql
python app.py
```

## 数据库结构说明

### 主要数据表
1. **house_info** - 房源信息表（113,318条记录）
2. **users** - 用户表
3. **favorites** - 收藏表
4. **browse_history** - 浏览记录表

### house_info表字段
- id: 房源ID
- title: 房源标题
- price: 价格
- region: 区域
- address: 详细地址
- rooms: 房型
- area: 面积
- latitude/longitude: 经纬度坐标

## 功能说明
- 房源搜索和筛选
- 用户注册/登录
- 房源收藏功能
- 浏览历史记录
- 地图找房功能
- 附近房源推荐
- 房源详情分析

## 技术栈
- **后端**：Flask + SQLAlchemy
- **数据库**：MySQL 9.3.0
- **前端**：Bootstrap 5 + JavaScript
- **地图**：集成地图API
- **环境**：Conda虚拟环境

## 维护说明
- 定期备份数据库
- 监控MySQL服务状态
- 清理日志文件
- 更新房源数据

---
**最后更新时间**：2025-09-25
**文档版本**：v1.0