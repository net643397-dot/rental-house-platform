{% extends "base.html" %}

{% block title %}浏览记录 - 租房网{% endblock %}

{% block content %}
<div class="container my-5">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('index') }}">首页</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('profile') }}">个人中心</a></li>
            <li class="breadcrumb-item active">浏览记录</li>
        </ol>
    </nav>

    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="fas fa-history text-info"></i> 我的浏览记录</h2>
                <small class="text-muted">
                    {% if browse_records.items %}
                    共 {{ browse_records.total }} 条记录，第 {{ browse_records.page }} 页 / 共 {{ browse_records.pages }} 页
                    {% endif %}
                </small>
            </div>
        </div>
    </div>

    {% if browse_records.items %}
    <div class="row">
        {% for record, house in browse_records.items %}
        <div class="col-lg-6 mb-4">
            <div class="card h-100 browse-history-card">
                <div class="row g-0">
                    <div class="col-md-4">
                        <img src="{{ url_for('static', filename='images/default-house.jpg') }}"
                             class="img-fluid rounded-start" alt="{{ house.title }}"
                             style="height: 160px; object-fit: cover;"
                             onerror="this.src='https://via.placeholder.com/200x160?text=房源图片'">
                    </div>
                    <div class="col-md-8">
                        <div class="card-body">
                            <h6 class="card-title">{{ house.title }}</h6>
                            <p class="card-text">
                                <small class="text-muted">
                                    <i class="fas fa-location-dot"></i> {{ house.address }}
                                </small>
                            </p>
                            <div class="house-info mb-2">
                                <div class="row">
                                    <div class="col-6">
                                        <small class="text-muted">房型:</small>
                                        <strong>{{ house.rooms }}</strong>
                                    </div>
                                    <div class="col-6">
                                        <small class="text-muted">面积:</small>
                                        <strong>{{ house.area }}㎡</strong>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="h6 text-danger mb-0">¥{{ house.price }}/月</span>
                                <span class="badge bg-primary">{{ house.rent_type }}</span>
                            </div>
                            <div class="mt-2">
                                <small class="text-muted d-flex align-items-center">
                                    <i class="fas fa-clock me-1"></i>
                                    浏览时间: {{ record.visit_time.strftime('%m-%d %H:%M') }}
                                </small>
                            </div>
                        </div>
                        <div class="card-footer bg-transparent">
                            <div class="d-flex justify-content-between">
                                <a href="{{ url_for('house_detail', house_id=house.id) }}"
                                   class="btn btn-primary btn-sm">
                                    <i class="fas fa-eye"></i> 再次查看
                                </a>
                                <span class="text-muted small">{{ house.region }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- 分页导航 -->
    {% if browse_records.pages > 1 %}
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            {% if browse_records.has_prev %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ browse_records.prev_num }}">
                        <i class="fas fa-chevron-left"></i> 上一页
                    </a>
                </li>
            {% endif %}

            {% for page_num in browse_records.iter_pages() %}
                {% if page_num %}
                    {% if page_num != browse_records.page %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_num }}">{{ page_num }}</a>
                        </li>
                    {% else %}
                        <li class="page-item active">
                            <span class="page-link">{{ page_num }}</span>
                        </li>
                    {% endif %}
                {% else %}
                    <li class="page-item disabled">
                        <span class="page-link">…</span>
                    </li>
                {% endif %}
            {% endfor %}

            {% if browse_records.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ browse_records.next_num }}">
                        下一页 <i class="fas fa-chevron-right"></i>
                    </a>
                </li>
            {% endif %}
        </ul>
    </nav>
    {% endif %}

    {% else %}
    <div class="text-center py-5">
        <i class="fas fa-history fa-3x text-muted mb-3"></i>
        <h4 class="text-muted">暂无浏览记录</h4>
        <p class="text-muted mb-4">您还没有浏览过任何房源</p>
        <a href="{{ url_for('index') }}" class="btn btn-primary">
            <i class="fas fa-search"></i> 去看看房源
        </a>
    </div>
    {% endif %}
</div>

<style>
.browse-history-card {
    transition: transform 0.2s, box-shadow 0.2s;
    border: 1px solid #dee2e6;
    border-radius: 0.5rem;
}

.browse-history-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.browse-history-card .card-title {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.browse-history-card .house-info {
    font-size: 0.85rem;
}

.browse-history-card .card-footer {
    padding: 0.75rem 1rem;
}

@media (max-width: 768px) {
    .browse-history-card .col-md-4 {
        display: none;
    }
    .browse-history-card .col-md-8 {
        flex: 0 0 100%;
        max-width: 100%;
    }
}
</style>
{% endblock %}