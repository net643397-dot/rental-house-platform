{% extends "base.html" %}

{% block title %}{{ house.title }} - 房源详情{% endblock %}

{% block extra_css %}
<!-- ECharts 图表库 -->
<script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
<style>
/* 应用主页风格到房源详情页 - 深色主题 */
/* ========== 全局样式 ========== */
body {
    background: #121212 !important;
    color: #ffffff !important;
}

.detail-container {
    margin-top: 2rem;
    margin-bottom: 3rem;
}

/* ========== Hero区域样式 (继承主页风格) ========== */
.hero-section-enhanced {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    position: relative;
    overflow: hidden;
    padding: 3rem 0;
    color: white;
}

.hero-section-enhanced::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.05)"/><circle cx="50" cy="10" r="0.8" fill="rgba(255,255,255,0.08)"/><circle cx="20" cy="80" r="0.6" fill="rgba(255,255,255,0.06)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
    opacity: 0.4;
}

.hero-content-enhanced {
    position: relative;
    z-index: 2;
}

/* ========== 面包屑导航 (深色风格) ========== */
.breadcrumb-container {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 1rem 0;
    margin-bottom: 0;
}

.elegant-breadcrumb {
    background: transparent;
    margin-bottom: 0;
    padding: 0;
}

.elegant-breadcrumb .breadcrumb-item a {
    color: rgba(255, 255, 255, 0.9);
    text-decoration: none;
    transition: all 0.3s ease;
    font-weight: 500;
}

.elegant-breadcrumb .breadcrumb-item a:hover {
    color: #ffffff;
    transform: translateY(-1px);
}

.elegant-breadcrumb .breadcrumb-item.active {
    color: #ffffff;
    font-weight: 600;
}

.elegant-breadcrumb .breadcrumb-item + .breadcrumb-item::before {
    content: "›";
    color: rgba(255, 255, 255, 0.7);
    font-weight: 600;
    font-size: 1.1em;
}

/* ========== 深色卡片系统 ========== */
.house-card-enhanced {
    border: 1px solid #444;
    border-radius: 20px;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
    transition: all 0.3s ease;
    overflow: hidden;
    background: #1e1e1e;
    margin-bottom: 1.5rem;
}

.house-card-enhanced:hover {
    transform: translateY(-8px);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
    border-color: #667eea;
}

.house-card-enhanced .card-body {
    padding: 1.5rem;
}

/* ========== 图片轮播区域 (深色风格) ========== */
.image-gallery-container {
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    position: relative;
    background: #1e1e1e;
    border: 1px solid #444;
}

.main-house-image {
    width: 100%;
    height: 450px;
    object-fit: cover;
    cursor: pointer;
    transition: transform 0.3s ease;
}

.main-house-image:hover {
    transform: scale(1.02);
}

.image-overlay {
    position: absolute;
    top: 15px;
    right: 15px;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 8px 12px;
    border-radius: 12px;
    font-size: 0.9rem;
    backdrop-filter: blur(10px);
    border: 1px solid #444;
}

.btn-quick-view {
    position: absolute;
    bottom: 15px;
    left: 15px;
    background: rgba(30, 30, 30, 0.95);
    border: 2px solid #444;
    padding: 10px 16px;
    border-radius: 12px;
    font-weight: 600;
    color: #ffffff;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
}

.btn-quick-view:hover {
    background: rgba(60, 60, 60, 0.95);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    border-color: #667eea;
    color: #ffffff;
}

/* ========== 房源标题和价格 (深色英雄风格) ========== */
.house-header-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px;
    color: white;
    padding: 2rem;
    box-shadow: 0 20px 60px rgba(102, 126, 234, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.1);
    position: relative;
    overflow: hidden;
}

.house-header-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.05)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
    opacity: 0.3;
}

.house-title-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
    position: relative;
    z-index: 2;
}

.house-title {
    font-size: 2.2rem;
    font-weight: 700;
    margin-bottom: 1rem;
    line-height: 1.2;
    text-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.title-badges {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.badge-premium {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 25px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.3rem;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(102, 126, 234, 0.3);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
}

.badge-type {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 25px;
    font-weight: 600;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(102, 126, 234, 0.3);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
}

.price-value {
    font-size: 3rem;
    font-weight: 800;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* ========== 信息卡片网格 (深色风格) ========== */
.info-cards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
}

.info-card {
    background: rgba(30, 30, 30, 0.95);
    border-radius: 20px;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
    overflow: hidden;
    transition: all 0.3s ease;
    border: 1px solid #444;
    backdrop-filter: blur(10px);
}

.info-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
    border-color: #667eea;
}

.info-card-header {
    padding: 1.5rem 1.5rem 1rem;
    display: flex;
    align-items: center;
    gap: 1rem;
}

.header-icon {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
}

.basic-info-card .header-icon {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.location-info-card .header-icon {
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
}

.stats-info-card .header-icon {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
}

.header-title {
    font-size: 1.3rem;
    font-weight: 700;
    margin: 0;
    color: #ffffff;
}

.info-card-body {
    padding: 0 1.5rem 1.5rem;
}

.info-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.8rem 0;
    border-bottom: 1px solid #444;
}

.info-item:last-child {
    border-bottom: none;
}

.info-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #b3b3b3;
    font-weight: 500;
}

.info-label i {
    width: 16px;
    text-align: center;
    color: #667eea;
}

.info-value {
    font-weight: 600;
    color: #ffffff;
}

.info-value.highlight {
    color: #667eea;
    font-weight: 700;
}

.house-code {
    background: rgba(102, 126, 234, 0.2);
    color: #667eea;
    padding: 0.2rem 0.5rem;
    border-radius: 8px;
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
    border: 1px solid rgba(102, 126, 234, 0.3);
}

/* ========== 右侧操作卡片 (深色风格) ========== */
.main-action-card {
    background: rgba(30, 30, 30, 0.95);
    border-radius: 20px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    overflow: hidden;
    border: 1px solid #444;
    backdrop-filter: blur(10px);
}

.action-card-header {
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
    color: white;
    padding: 2rem;
    text-align: center;
    position: relative;
}

.action-card-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
    opacity: 0.3;
}

.price-amount {
    font-size: 2.5rem;
    font-weight: 800;
    display: block;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    position: relative;
    z-index: 2;
}

.action-card-body {
    padding: 1.5rem;
}

.btn-action {
    width: 100%;
    background: rgba(44, 44, 44, 0.9);
    border: 2px solid #444;
    border-radius: 12px;
    padding: 1rem;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    text-decoration: none;
    color: #ffffff;
    transition: all 0.3s ease;
    cursor: pointer;
}

.btn-action:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    border-color: #667eea;
    color: #ffffff;
    background: rgba(60, 60, 60, 0.9);
}

.btn-contact {
    border-color: #667eea;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
}

.btn-contact:hover {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2));
    color: #ffffff;
}

.btn-favorite.favorited {
    border-color: #ff6b6b;
    background: linear-gradient(135deg, rgba(255, 107, 107, 0.1), rgba(238, 90, 82, 0.1));
    color: #ff6b6b;
}

.btn-icon {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.3rem;
    background: rgba(102, 126, 234, 0.2);
    color: #667eea;
    flex-shrink: 0;
}

.btn-contact .btn-icon {
    background: rgba(102, 126, 234, 0.2);
    color: #667eea;
}

.btn-favorite.favorited .btn-icon {
    background: rgba(255, 107, 107, 0.2);
    color: #ff6b6b;
}

/* ========== 通用卡片样式 ========== */
.card {
    background: rgba(30, 30, 30, 0.95) !important;
    border: 1px solid #444 !important;
    border-radius: 20px !important;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2) !important;
    color: #ffffff !important;
    backdrop-filter: blur(10px) !important;
    transition: all 0.3s ease !important;
    margin-bottom: 1.5rem !important;
}

.card:hover {
    transform: translateY(-5px) !important;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4) !important;
    border-color: #667eea !important;
}

.card-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
    border: none !important;
    color: white !important;
    border-radius: 20px 20px 0 0 !important;
    padding: 1.5rem !important;
}

.card-header h5 {
    margin: 0 !important;
    font-weight: 600 !important;
    color: white !important;
}

.card-body {
    padding: 1.5rem !important;
    background: transparent !important;
}

/* ========== 标签和徽章 ========== */
.info-tag-enhanced {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 15px;
    font-size: 0.8rem;
    font-weight: 500;
    margin: 0.25rem 0.25rem 0.25rem 0;
    display: inline-block;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
    transition: all 0.3s ease;
}

.info-tag-enhanced:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
}

.badge {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
    color: white !important;
    padding: 0.5rem 1rem !important;
    border-radius: 15px !important;
    font-weight: 600 !important;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2) !important;
    border: 1px solid rgba(102, 126, 234, 0.3) !important;
    transition: all 0.3s ease !important;
}

.badge:hover {
    transform: translateY(-2px) !important;
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3) !important;
}

/* ========== 推荐房源 ========== */
.recommendation-card {
    background: rgba(30, 30, 30, 0.95) !important;
    transition: all 0.3s ease !important;
    border: 1px solid #444 !important;
    border-radius: 12px !important;
    overflow: hidden !important;
}

.recommendation-card:hover {
    transform: translateY(-5px) !important;
    box-shadow: 0 15px 40px rgba(0,0,0,0.3) !important;
    border-color: #667eea !important;
}

.recommendation-card .card-title {
    color: #ffffff !important;
    font-weight: 600 !important;
}

.recommendation-card .card-text {
    color: #b3b3b3 !important;
}

.recommendation-card .btn {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%) !important;
    border: none !important;
    color: white !important;
    border-radius: 8px !important;
    font-weight: 600 !important;
    transition: all 0.3s ease !important;
}

.recommendation-card .btn:hover {
    transform: translateY(-2px) !important;
    box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3) !important;
    color: white !important;
}

/* ========== 链接样式 ========== */
.btn-link {
    color: #667eea !important;
    font-weight: 600 !important;
    text-decoration: none !important;
    transition: all 0.3s ease !important;
}

.btn-link:hover {
    color: #ffffff !important;
    transform: translateY(-1px) !important;
}

/* ========== 文本颜色 ========== */
.text-muted {
    color: #b3b3b3 !important;
}

.text-success {
    color: #28a745 !important;
}

.fw-bold, .font-weight-bold {
    color: #ffffff !important;
}

/* ========== 响应式设计 ========== */
@media (max-width: 992px) {
    .house-title-section {
        flex-direction: column;
        text-align: center;
    }

    .price-section {
        text-align: center;
    }

    .info-cards-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .house-title {
        font-size: 1.8rem;
    }

    .price-value {
        font-size: 2.2rem;
    }

    .btn-action {
        padding: 0.8rem;
    }

    .main-house-image {
        height: 300px;
    }
}

/* ========== 图片模态框 ========== */
.image-modal {
    display: none;
    position: fixed;
    z-index: 9999;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(10px);
}

.modal-content-img {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    object-fit: contain;
}

.close-modal {
    position: absolute;
    top: 20px;
    right: 35px;
    color: white;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
}

.close-modal:hover {
    color: #667eea;
}

/* ========== 动画效果 ========== */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.info-card,
.action-card,
.house-card-enhanced {
    animation: fadeInUp 0.6s ease-out;
}
</style>
{% endblock %}

{% block content %}
<div style="background: #121212; min-height: 100vh; color: #ffffff;">
<!-- 顶部面包屑导航 -->
<div class="breadcrumb-container">
    <div class="container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb elegant-breadcrumb">
                <li class="breadcrumb-item">
                    <a href="{{ url_for('index') }}">
                        <i class="fas fa-home"></i> 首页
                    </a>
                </li>
                <li class="breadcrumb-item">
                    <a href="{{ url_for('index', region=house.region) }}">
                        <i class="fas fa-map-marker-alt"></i> {{ house.region }}
                    </a>
                </li>
                <li class="breadcrumb-item active">
                    <i class="fas fa-building"></i> 房源详情
                </li>
            </ol>
        </nav>
    </div>
</div>

<div class="container detail-container">
    <div class="row">
        <div class="col-lg-8">
            <!-- 房源图片轮播 -->
            <div class="image-gallery-container mb-4">
                <div class="main-image-wrapper">
                    <div id="houseCarousel" class="carousel slide" data-bs-ride="carousel">
                        <div class="carousel-inner">
                            <div class="carousel-item active">
                                <img src="{{ url_for('static', filename='images/house1.jpg') }}"
                                     class="main-house-image" alt="现代小户型客厅"
                                     onerror="this.src='{{ url_for('static', filename='images/default-house.jpg') }}'"
                                     onclick="openImageModal(this.src)">
                                <div class="image-overlay">
                                    <span class="image-count">
                                        <i class="fas fa-camera"></i> 1 / 7
                                    </span>
                                </div>
                            </div>
                            <!-- 可以添加更多图片轮播项 -->
                            <div class="carousel-item">
                                <img src="{{ url_for('static', filename='images/house2.jpg') }}"
                                     class="main-house-image" alt="温馨居室"
                                     onerror="this.src='{{ url_for('static', filename='images/default-house.jpg') }}'"
                                     onclick="openImageModal(this.src)">
                                <div class="image-overlay">
                                    <span class="image-count">
                                        <i class="fas fa-camera"></i> 2 / 7
                                    </span>
                                </div>
                            </div>
                            <div class="carousel-item">
                                <img src="{{ url_for('static', filename='images/house3.jpg') }}"
                                     class="main-house-image" alt="简约卧室"
                                     onerror="this.src='{{ url_for('static', filename='images/default-house.jpg') }}'"
                                     onclick="openImageModal(this.src)">
                                <div class="image-overlay">
                                    <span class="image-count">
                                        <i class="fas fa-camera"></i> 3 / 7
                                    </span>
                                </div>
                            </div>
                            <div class="carousel-item">
                                <img src="{{ url_for('static', filename='images/house4.jpg') }}"
                                     class="main-house-image" alt="主卧室套房"
                                     onerror="this.src='{{ url_for('static', filename='images/default-house.jpg') }}'"
                                     onclick="openImageModal(this.src)">
                                <div class="image-overlay">
                                    <span class="image-count">
                                        <i class="fas fa-camera"></i> 4 / 7
                                    </span>
                                </div>
                            </div>
                            <div class="carousel-item">
                                <img src="{{ url_for('static', filename='images/default-house.jpg') }}"
                                     class="main-house-image" alt="房源外观"
                                     onclick="openImageModal(this.src)">
                                <div class="image-overlay">
                                    <span class="image-count">
                                        <i class="fas fa-camera"></i> 5 / 7
                                    </span>
                                </div>
                            </div>
                            <div class="carousel-item">
                                <img src="{{ url_for('static', filename='images/house5.jpg') }}"
                                     class="main-house-image" alt="现代厨房"
                                     onerror="this.src='{{ url_for('static', filename='images/default-house.jpg') }}'"
                                     onclick="openImageModal(this.src)">
                                <div class="image-overlay">
                                    <span class="image-count">
                                        <i class="fas fa-camera"></i> 6 / 7
                                    </span>
                                </div>
                            </div>
                            <div class="carousel-item">
                                <img src="{{ url_for('static', filename='images/house6.jpg') }}"
                                     class="main-house-image" alt="明亮卫生间"
                                     onerror="this.src='{{ url_for('static', filename='images/default-house.jpg') }}'"
                                     onclick="openImageModal(this.src)">
                                <div class="image-overlay">
                                    <span class="image-count">
                                        <i class="fas fa-camera"></i> 7 / 7
                                    </span>
                                </div>
                            </div>
                        </div>

                        <!-- 轮播控制按钮 -->
                        <button class="carousel-control-prev" type="button" data-bs-target="#houseCarousel" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon"></span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#houseCarousel" data-bs-slide="next">
                            <span class="carousel-control-next-icon"></span>
                        </button>

                        <!-- 轮播指示器 -->
                        <div class="carousel-indicators">
                            <button type="button" data-bs-target="#houseCarousel" data-bs-slide-to="0" class="active"></button>
                            <button type="button" data-bs-target="#houseCarousel" data-bs-slide-to="1"></button>
                            <button type="button" data-bs-target="#houseCarousel" data-bs-slide-to="2"></button>
                            <button type="button" data-bs-target="#houseCarousel" data-bs-slide-to="3"></button>
                            <button type="button" data-bs-target="#houseCarousel" data-bs-slide-to="4"></button>
                            <button type="button" data-bs-target="#houseCarousel" data-bs-slide-to="5"></button>
                            <button type="button" data-bs-target="#houseCarousel" data-bs-slide-to="6"></button>
                        </div>
                    </div>

                    <!-- 快速查看按钮 -->
                    <button class="btn-quick-view" onclick="openImageModal()">
                        <i class="fas fa-expand"></i> 查看大图
                    </button>
                </div>
            </div>

            <!-- 房源标题和价格区域 -->
            <div class="house-header-card mb-4">
                <div class="house-title-section">
                    <div class="title-wrapper">
                        <h1 class="house-title">{{ house.title }}</h1>
                        <div class="title-badges">
                            <span class="badge badge-premium">
                                <i class="fas fa-crown"></i> 优质房源
                            </span>
                            {% if house.rent_type %}
                            <span class="badge badge-type">{{ house.rent_type }}</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="price-section">
                        <div class="main-price">
                            <span class="price-value">¥{{ house.price }}</span>
                            <span class="price-unit">/月</span>
                        </div>
                        {% if house.area %}
                        <div class="price-per-sqm">
                            约¥{{ "%.1f"|format((house.price|int / house.area|int)) }}/㎡/月
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- 房源核心信息卡片 -->
            <div class="info-cards-grid mb-4">
                <!-- 基本信息卡 -->
                <div class="info-card basic-info-card">
                    <div class="info-card-header">
                        <div class="header-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <h3 class="header-title">基本信息</h3>
                    </div>
                    <div class="info-card-body">
                        <div class="info-item">
                            <div class="info-label">
                                <i class="fas fa-door-open"></i>
                                <span>房型</span>
                            </div>
                            <div class="info-value highlight">{{ house.rooms }}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">
                                <i class="fas fa-expand-arrows-alt"></i>
                                <span>面积</span>
                            </div>
                            <div class="info-value">{{ house.area }}㎡</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">
                                <i class="fas fa-compass"></i>
                                <span>朝向</span>
                            </div>
                            <div class="info-value">{{ house.direction or '未知' }}</div>
                        </div>
                    </div>
                </div>

                <!-- 位置信息卡 -->
                <div class="info-card location-info-card">
                    <div class="info-card-header">
                        <div class="header-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <h3 class="header-title">位置信息</h3>
                    </div>
                    <div class="info-card-body">
                        <div class="info-item">
                            <div class="info-label">
                                <i class="fas fa-city"></i>
                                <span>区域</span>
                            </div>
                            <div class="info-value highlight">{{ house.region }}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">
                                <i class="fas fa-map"></i>
                                <span>板块</span>
                            </div>
                            <div class="info-value">{{ house.block }}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">
                                <i class="fas fa-location-dot"></i>
                                <span>地址</span>
                            </div>
                            <div class="info-value address-text">{{ house.address }}</div>
                        </div>
                    </div>
                </div>

                <!-- 统计信息卡 -->
                <div class="info-card stats-info-card">
                    <div class="info-card-header">
                        <div class="header-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3 class="header-title">统计信息</h3>
                    </div>
                    <div class="info-card-body">
                        <div class="info-item">
                            <div class="info-label">
                                <i class="fas fa-eye"></i>
                                <span>浏览</span>
                            </div>
                            <div class="info-value">{{ house.page_views or 0 }}次</div>
                        </div>
                        {% if house.publish_time %}
                        <div class="info-item">
                            <div class="info-label">
                                <i class="fas fa-calendar"></i>
                                <span>发布</span>
                            </div>
                            <div class="info-value">
                                {% set publish_timestamp = house.publish_time|int %}
                                {% if publish_timestamp > 1000000000 %}
                                    <span class="publish-date" data-timestamp="{{ publish_timestamp }}">
                                        {{ (publish_timestamp|int)|timestamp_to_date }}
                                    </span>
                                {% else %}
                                    {{ publish_timestamp }}天前
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}
                        {% if house.house_num %}
                        <div class="info-item">
                            <div class="info-label">
                                <i class="fas fa-hashtag"></i>
                                <span>编号</span>
                            </div>
                            <div class="info-value">
                                <code class="house-code">{{ house.house_num }}</code>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- 房源描述 -->
            {% if house.highlights %}
            <div class="card mb-4">
                <div class="card-header">
                    <h5><i class="fas fa-star" style="color: #6c757d;"></i> 房源亮点</h5>
                </div>
                <div class="card-body">
                    <p>{{ house.highlights }}</p>
                </div>
            </div>
            {% endif %}

            <!-- 设施配套 -->
            {% if house.facilities %}
            <div class="card mb-4">
                <div class="card-header">
                    <h5><i class="fas fa-home"></i> 房屋设施</h5>
                </div>
                <div class="card-body">
                    <div class="facilities">
                        {% for facility in house.facilities.split('-') %}
                            {% if facility.strip() %}
                            <span class="badge me-2 mb-2">
                                <i class="fas fa-check"></i> {{ facility.strip() }}
                            </span>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- 出行信息 -->
            {% if house.travel %}
            <div class="card mb-4">
                <div class="card-header">
                    <h5><i class="fas fa-route"></i> 出行信息</h5>
                </div>
                <div class="card-body">
                    <p class="mb-0"><i class="fas fa-subway" style="color: #6c757d;"></i> {{ house.travel }}</p>
                </div>
            </div>
            {% endif %}

            <!-- 配套信息 -->
            {% if house.matching %}
            <div class="card mb-4">
                <div class="card-header">
                    <h5><i class="fas fa-map-marked-alt"></i> 周边配套</h5>
                </div>
                <div class="card-body">
                    <div class="matching-info">
                        {% set matching_items = house.matching.split('\n') if house.matching else [] %}
                        {% for item in matching_items %}
                            {% if item.strip() %}
                            <div class="mb-2">
                                <i class="fas fa-map-pin text-success"></i>
                                <span>{{ item.strip() }}</span>
                            </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- 推荐房源 -->
            {% if similar_houses %}
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-thumbs-up" style="color: #6c757d;"></i> 推荐房源</h5>
                    <small class="text-muted">为您推荐相似的优质房源</small>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% for rec_house in similar_houses %}
                        <div class="col-lg-6 col-md-4 mb-3">
                            <div class="card h-100 recommendation-card">
                                <img src="{{ url_for('static', filename='images/default-house.jpg') }}"
                                     class="card-img-top" alt="{{ rec_house.title }}"
                                     style="height: 120px; object-fit: cover;"
                                     onerror="this.src='https://via.placeholder.com/200x120?text=房源图片'">
                                <div class="card-body p-2">
                                    <h6 class="card-title text-truncate">{{ rec_house.title }}</h6>
                                    <p class="card-text small text-muted mb-1">
                                        <i class="fas fa-location-dot"></i> {{ rec_house.region }}
                                    </p>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span class="fw-bold" style="color: #6c757d;">¥{{ rec_house.price }}/月</span>
                                        <span class="badge">{{ rec_house.rooms }}</span>
                                    </div>
                                    <div class="mt-2">
                                        <a href="{{ url_for('house_detail', house_id=rec_house.id) }}"
                                           class="btn btn-outline-secondary btn-sm w-100">查看详情</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>

                    <!-- 查看更多推荐 -->
                    <div class="text-center mt-3">
                        <a href="{{ url_for('index', region=house.region, rent_type=house.rent_type) }}"
                           class="btn btn-link">
                            <i class="fas fa-external-link-alt"></i> 查看更多相似房源
                        </a>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>

        <div class="col-lg-4 right-sidebar">
            <!-- 主要操作卡片 -->
            <div class="action-card main-action-card mb-4">
                <div class="action-card-header">
                    <div class="price-highlight">
                        <span class="price-label">月租</span>
                        <span class="price-amount">¥{{ house.price }}</span>
                    </div>
                    {% if house.area %}
                    <div class="price-subtitle">
                        约¥{{ "%.1f"|format((house.price|int / house.area|int)) }}/㎡
                    </div>
                    {% endif %}
                </div>

                <div class="action-card-body">
                    <!-- 联系按钮 -->
                    <button class="btn-action btn-contact" onclick="contactLandlord()">
                        <div class="btn-icon">
                            <i class="fas fa-phone"></i>
                        </div>
                        <div class="btn-content">
                            <span class="btn-title">立即咨询</span>
                            <span class="btn-subtitle">获取房源详情</span>
                        </div>
                    </button>

                    <!-- 收藏按钮 -->
                    {% if session.user_id %}
                    <button class="btn-action btn-favorite" id="favoriteBtn" onclick="toggleFavorite({{ house.id }})">
                        <div class="btn-icon">
                            <i class="fas fa-heart" id="favoriteIcon"></i>
                        </div>
                        <div class="btn-content">
                            <span class="btn-title" id="favoriteText">收藏房源</span>
                            <span class="btn-subtitle">保存到我的收藏</span>
                        </div>
                    </button>
                    {% else %}
                    <a href="{{ url_for('login') }}" class="btn-action btn-favorite">
                        <div class="btn-icon">
                            <i class="fas fa-heart"></i>
                        </div>
                        <div class="btn-content">
                            <span class="btn-title">登录后收藏</span>
                            <span class="btn-subtitle">保存到我的收藏</span>
                        </div>
                    </a>
                    {% endif %}

                    <!-- 分享按钮 -->
                    <button class="btn-action btn-share" onclick="shareHouse()">
                        <div class="btn-icon">
                            <i class="fas fa-share-alt"></i>
                        </div>
                        <div class="btn-content">
                            <span class="btn-title">分享房源</span>
                            <span class="btn-subtitle">推荐给朋友</span>
                        </div>
                    </button>
                </div>
            </div>

            <!-- 数据可视化图表 -->
            <!-- 饼图：区域户型分布 -->
            <div class="card mb-4" id="pieChartCard">
                <div class="card-header">
                    <h5><i class="fas fa-home"></i> {{ house.region }}区域户型分布</h5>
                    <small class="text-muted">该区域各户型占比统计</small>
                </div>
                <div class="card-body">
                    <div id="pieChart" style="height: 400px;"></div>
                </div>
            </div>

            <!-- 条形图：单价对比 -->
            <div class="card mb-4" id="barChartCard">
                <div class="card-header">
                    <h5><i class="fas fa-chart-bar"></i> 单价对比分析</h5>
                    <small class="text-muted">当前房源单价与区域平均单价对比</small>
                </div>
                <div class="card-body">
                    <div id="barChart" style="height: 400px;"></div>
                </div>
            </div>

            <!-- 玫瑰图：朝向分布 -->
            <div class="card mb-4" id="roseChartCard">
                <div class="card-header">
                    <h5><i class="fas fa-compass"></i> {{ house.region }}区域朝向分布</h5>
                    <small class="text-muted">该区域房源朝向分布统计</small>
                </div>
                <div class="card-body">
                    <div id="roseChart" style="height: 400px;"></div>
                </div>
            </div>

            <!-- 直方图：价格分布 -->
            <div class="card mb-4" id="histogramChartCard">
                <div class="card-header">
                    <h5><i class="fas fa-chart-column"></i> {{ house.region }}区域价格分布</h5>
                    <small class="text-muted">该区域房源价格分布情况</small>
                </div>
                <div class="card-body">
                    <div id="histogramChart" style="height: 400px;"></div>
                </div>
            </div>

            <!-- 散点图：面积-价格关系 -->
            <div class="card mb-4" id="scatterChartCard">
                <div class="card-header">
                    <h5><i class="fas fa-chart-scatter"></i> {{ house.region }}区域面积-价格分布</h5>
                    <small class="text-muted">查看当前房源性价比，红色标注为当前房源</small>
                </div>
                <div class="card-body">
                    <div id="scatterChart" style="height: 450px;"></div>
                </div>
            </div>

            <!-- 加载提示 -->
            <div class="text-center py-5" id="chartsLoading">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2 text-muted">正在加载图表数据...</p>
            </div>


            <!-- 联系信息 -->
            {% if house.landlord or house.phone_num %}
            <div class="card mb-4">
                <div class="card-header">
                    <h5><i class="fas fa-user"></i> 联系信息</h5>
                </div>
                <div class="card-body">
                    {% if house.landlord %}
                    <p><strong>联系人:</strong> {{ house.landlord }}</p>
                    {% endif %}
                    {% if house.phone_num %}
                    <p><strong>电话:</strong>
                        <a href="tel:{{ house.phone_num }}" style="color: #6c757d;">
                            {{ house.phone_num }}
                        </a>
                    </p>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
// 收藏功能
let isFavorite = false;

// 清理所有残留的模态框和遮罩层
function cleanupModals() {
    // 移除所有模态框元素
    document.querySelectorAll('.modal').forEach(modal => {
        const instance = bootstrap.Modal.getInstance(modal);
        if (instance) {
            instance.dispose();
        }
        modal.remove();
    });

    // 移除所有背景遮罩
    document.querySelectorAll('.modal-backdrop').forEach(backdrop => {
        backdrop.remove();
    });

    // 恢复 body 样式
    document.body.classList.remove('modal-open');
    document.body.style.removeProperty('overflow');
    document.body.style.removeProperty('padding-right');
}

// 页面加载时清理残留模态框并加载数据
document.addEventListener('DOMContentLoaded', function() {
    // 清理任何残留的模态框
    cleanupModals();

    {% if session.user_id %}
    checkFavoriteStatus({{ house.id }});
    {% endif %}

    // 加载图表数据
    loadCharts({{ house.id }});
});

// 检查收藏状态
function checkFavoriteStatus(houseId) {
    fetch(`/api/favorites/check/${houseId}`)
        .then(response => response.json())
        .then(data => {
            isFavorite = data.is_favorite;
            updateFavoriteButton();
        })
        .catch(error => {
            console.error('Error:', error);
        });
}

// 切换收藏状态
function toggleFavorite(houseId) {
    const method = isFavorite ? 'DELETE' : 'POST';
    const body = JSON.stringify({ house_id: houseId });

    fetch('/api/favorites', {
        method: method,
        headers: {
            'Content-Type': 'application/json',
        },
        body: body
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            isFavorite = !isFavorite;
            updateFavoriteButton();
            alert(data.message);
        } else {
            alert(data.message);
            if (data.message.includes('登录')) {
                window.location.href = '/login';
            }
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('操作失败，请稍后重试');
    });
}

// 更新收藏按钮状态
function updateFavoriteButton() {
    const btn = document.getElementById('favoriteBtn');
    const icon = document.getElementById('favoriteIcon');
    const text = document.getElementById('favoriteText');

    if (isFavorite) {
        btn.classList.add('favorited');
        btn.classList.add('btn-favorite');
        icon.className = 'fas fa-heart';
        text.textContent = '已收藏';
    } else {
        btn.classList.remove('favorited');
        btn.classList.add('btn-favorite');
        icon.className = 'far fa-heart';
        text.textContent = '收藏房源';
    }
}

// 图片模态框功能
function openImageModal(imageSrc) {
    // 创建模态框
    if (!document.getElementById('imageModal')) {
        const modal = document.createElement('div');
        modal.id = 'imageModal';
        modal.className = 'image-modal';
        modal.innerHTML = `
            <span class="close-modal" onclick="closeImageModal()">&times;</span>
            <img class="modal-content-img" id="modalImage">
        `;
        document.body.appendChild(modal);
    }

    const modal = document.getElementById('imageModal');
    const modalImg = document.getElementById('modalImage');

    if (imageSrc) {
        modalImg.src = imageSrc;
    } else {
        // 获取当前活跃的轮播图片
        const activeImg = document.querySelector('.carousel-item.active img');
        modalImg.src = activeImg.src;
    }

    modal.style.display = 'block';
    document.body.style.overflow = 'hidden';

    // 点击模态框背景关闭
    modal.onclick = function(event) {
        if (event.target === modal) {
            closeImageModal();
        }
    }
}

function closeImageModal() {
    const modal = document.getElementById('imageModal');
    modal.style.display = 'none';
    document.body.style.overflow = 'auto';
}

// 键盘事件监听
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        closeImageModal();
        // ESC键也可以强制清理所有模态框
        cleanupModals();
    }
});

// 联系房东功能
function contactLandlord() {
    // 检查是否有联系方式
    const phone = '{{ house.phone_num if house.phone_num else "" }}';
    const landlord = '{{ house.landlord if house.landlord else "" }}';

    if (phone) {
        // 显示联系方式选择模态框
        showContactModal(phone, landlord);
    } else {
        // 显示咨询表单
        showInquiryForm();
    }
}

function showContactModal(phone, landlord) {
    const modalHtml = `
        <div class="modal fade" id="contactModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">
                            <i class="fas fa-phone" style="color: #6c757d;"></i> 联系房东
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body text-center">
                        ${landlord ? `<p class="mb-3"><strong>联系人：</strong>${landlord}</p>` : ''}
                        <div class="contact-options">
                            <a href="tel:${phone}" class="btn btn-primary btn-lg mb-3 w-100">
                                <i class="fas fa-phone"></i> 拨打电话：${phone}
                            </a>
                            <button class="btn btn-success btn-lg w-100" onclick="copyToClipboard('${phone}')">
                                <i class="fas fa-copy"></i> 复制号码
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;

    // 移除已存在的模态框
    const existingModal = document.getElementById('contactModal');
    if (existingModal) {
        existingModal.remove();
    }

    document.body.insertAdjacentHTML('beforeend', modalHtml);
    const modal = new bootstrap.Modal(document.getElementById('contactModal'));
    modal.show();
}

function showInquiryForm() {
    const modalHtml = `
        <div class="modal fade" id="inquiryModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">
                            <i class="fas fa-envelope" style="color: #6c757d;"></i> 咨询房源
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form id="inquiryForm">
                            <div class="mb-3">
                                <label class="form-label">您的姓名</label>
                                <input type="text" class="form-control" name="name" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">联系电话</label>
                                <input type="tel" class="form-control" name="phone" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">咨询内容</label>
                                <textarea class="form-control" name="message" rows="3"
                                    placeholder="请输入您想了解的问题...">我对这套房源很感兴趣，希望能了解更多详情。</textarea>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-paper-plane"></i> 发送咨询
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    `;

    const existingModal = document.getElementById('inquiryModal');
    if (existingModal) {
        existingModal.remove();
    }

    document.body.insertAdjacentHTML('beforeend', modalHtml);
    const modal = new bootstrap.Modal(document.getElementById('inquiryModal'));
    modal.show();

    // 表单提交处理
    document.getElementById('inquiryForm').addEventListener('submit', function(e) {
        e.preventDefault();
        // 这里可以添加表单提交逻辑
        alert('咨询信息已提交，我们会尽快联系您！');
        modal.hide();
    });
}

// 分享房源功能
function shareHouse() {
    const url = window.location.href;
    const title = '{{ house.title }}';
    const text = `推荐一套优质房源：${title}，月租¥{{ house.price }}`;

    if (navigator.share) {
        // 使用原生分享API（移动端）
        navigator.share({
            title: title,
            text: text,
            url: url
        }).catch(err => console.log('分享失败', err));
    } else {
        // 显示分享选项模态框
        showShareModal(url, title, text);
    }
}

function showShareModal(url, title, text) {
    const modalHtml = `
        <div class="modal fade" id="shareModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">
                            <i class="fas fa-share-alt" style="color: #6c757d;"></i> 分享房源
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="share-options">
                            <button class="btn btn-outline-secondary mb-2 w-100" onclick="copyToClipboard('${url}')">
                                <i class="fas fa-link"></i> 复制链接
                            </button>
                            <button class="btn btn-outline-success mb-2 w-100" onclick="shareToWeChat('${url}', '${title}')">
                                <i class="fab fa-weixin"></i> 分享到微信
                            </button>
                            <button class="btn btn-outline-info mb-2 w-100" onclick="shareToQQ('${url}', '${title}')">
                                <i class="fab fa-qq"></i> 分享到QQ
                            </button>
                            <button class="btn btn-outline-dark w-100" onclick="shareToEmail('${url}', '${title}', '${text}')">
                                <i class="fas fa-envelope"></i> 邮件分享
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;

    // 移除已存在的模态框
    const existingModal = document.getElementById('shareModal');
    if (existingModal) {
        const existingInstance = bootstrap.Modal.getInstance(existingModal);
        if (existingInstance) {
            existingInstance.dispose();
        }
        existingModal.remove();
    }

    // 插入新的模态框HTML
    document.body.insertAdjacentHTML('beforeend', modalHtml);

    // 创建并显示模态框
    const modalElement = document.getElementById('shareModal');
    const modal = new bootstrap.Modal(modalElement);

    // 监听模态框关闭事件，关闭后清理DOM
    modalElement.addEventListener('hidden.bs.modal', function () {
        modal.dispose();
        modalElement.remove();
        // 移除任何残留的背景遮罩
        document.querySelectorAll('.modal-backdrop').forEach(el => el.remove());
        document.body.classList.remove('modal-open');
        document.body.style.removeProperty('overflow');
        document.body.style.removeProperty('padding-right');
    });

    modal.show();
}

// 复制到剪贴板
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(function() {
        showToast('已复制到剪贴板！', 'success');
    }, function(err) {
        // 降级方案
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        showToast('已复制到剪贴板！', 'success');
    });
}

// 各种分享方式
function shareToWeChat(url, title) {
    // 微信分享通常需要微信JS-SDK
    showToast('请复制链接在微信中分享', 'info');
    copyToClipboard(url);
}

function shareToQQ(url, title) {
    const shareUrl = `https://connect.qq.com/widget/shareqq/index.html?url=${encodeURIComponent(url)}&title=${encodeURIComponent(title)}`;
    window.open(shareUrl, '_blank');
}

function shareToEmail(url, title, text) {
    const mailtoUrl = `mailto:?subject=${encodeURIComponent(title)}&body=${encodeURIComponent(text + '\n\n' + url)}`;
    window.location.href = mailtoUrl;
}

// Toast 通知
function showToast(message, type = 'info') {
    // 创建toast容器
    if (!document.getElementById('toastContainer')) {
        const container = document.createElement('div');
        container.id = 'toastContainer';
        container.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
        `;
        document.body.appendChild(container);
    }

    const toastId = 'toast_' + Date.now();
    const bgColor = type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#17a2b8';

    const toastHtml = `
        <div id="${toastId}" class="toast-notification" style="
            background: ${bgColor};
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transform: translateX(400px);
            transition: all 0.3s ease;
            font-weight: 500;
        ">
            <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'times' : 'info'}-circle"></i>
            ${message}
        </div>
    `;

    document.getElementById('toastContainer').insertAdjacentHTML('beforeend', toastHtml);

    const toast = document.getElementById(toastId);
    setTimeout(() => toast.style.transform = 'translateX(0)', 100);

    setTimeout(() => {
        toast.style.transform = 'translateX(400px)';
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}

// 加载图表数据
function loadCharts(houseId) {
    fetch(`/api/house-charts/${houseId}`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // 隐藏加载提示
                document.getElementById('chartsLoading').style.display = 'none';

                // 渲染饼图
                renderPieChart(data.pie_data, data.current_house);

                // 渲染条形图
                renderBarChart(data.bar_data, data.current_house);

                // 渲染玫瑰图
                renderRoseChart(data.rose_data, data.current_house);

                // 渲染直方图
                renderHistogramChart(data.histogram_data, data.current_house);

                // 渲染散点图
                renderScatterChart(data.scatter_data, data.current_house);
            } else {
                document.getElementById('chartsLoading').innerHTML =
                    '<div class="text-center py-3"><i class="fas fa-exclamation-triangle text-warning"></i><p class="mt-2 text-muted">图表数据加载失败</p></div>';
            }
        })
        .catch(error => {
            console.error('Error loading charts:', error);
            document.getElementById('chartsLoading').innerHTML =
                '<div class="text-center py-3"><i class="fas fa-exclamation-triangle text-danger"></i><p class="mt-2 text-muted">数据加载出错</p></div>';
        });
}

// 渲染饼图 - 区域户型分布
function renderPieChart(pieData, currentHouse) {
    const chartDom = document.getElementById('pieChart');
    const myChart = echarts.init(chartDom);

    const option = {
        tooltip: {
            trigger: 'item',
            formatter: '{b}: {c}套 ({d}%)',
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            borderColor: '#667eea',
            borderWidth: 1,
            textStyle: {
                color: '#ffffff'
            }
        },
        legend: {
            orient: 'horizontal',
            bottom: '5%',
            left: 'center',
            textStyle: {
                color: '#ffffff',
                fontSize: 13
            },
            itemWidth: 20,
            itemHeight: 14,
            itemGap: 15
        },
        grid: {
            left: '5%',
            right: '5%',
            top: '5%',
            bottom: '15%',
            containLabel: true
        },
        series: [
            {
                name: '户型分布',
                type: 'pie',
                radius: ['35%', '60%'],
                center: ['50%', '45%'],
                avoidLabelOverlap: true,
                itemStyle: {
                    borderRadius: 10,
                    borderColor: '#1e1e1e',
                    borderWidth: 2
                },
                label: {
                    show: true,
                    position: 'outside',
                    formatter: '{b}\n{d}%',
                    color: '#ffffff',
                    fontSize: 12,
                    distanceToLabelLine: 5
                },
                emphasis: {
                    label: {
                        show: true,
                        fontSize: 16,
                        fontWeight: 'bold'
                    },
                    itemStyle: {
                        shadowBlur: 10,
                        shadowOffsetX: 0,
                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                    }
                },
                labelLine: {
                    show: true,
                    length: 15,
                    length2: 10,
                    lineStyle: {
                        color: '#667eea',
                        width: 1
                    }
                },
                data: pieData,
                color: ['#667eea', '#764ba2', '#f093fb', '#4facfe', '#00f2fe', '#43e97b', '#fa709a', '#fee140']
            }
        ],
        backgroundColor: 'transparent'
    };

    myChart.setOption(option);

    // 响应式
    window.addEventListener('resize', function() {
        myChart.resize();
    });
}

// 渲染条形图 - 单价对比
function renderBarChart(barData, currentHouse) {
    const chartDom = document.getElementById('barChart');
    const myChart = echarts.init(chartDom);

    const option = {
        tooltip: {
            trigger: 'axis',
            axisPointer: {
                type: 'shadow'
            },
            formatter: function(params) {
                return params[0].name + '<br/>' +
                       '单价: ¥' + params[0].value.toFixed(2) + '/㎡·月';
            }
        },
        grid: {
            left: '3%',
            right: '4%',
            bottom: '3%',
            top: '15%',
            containLabel: true
        },
        xAxis: {
            type: 'category',
            data: barData.categories,
            axisLabel: {
                color: '#ffffff',
                fontSize: 12
            },
            axisLine: {
                lineStyle: {
                    color: '#444'
                }
            }
        },
        yAxis: {
            type: 'value',
            name: '单价 (元/㎡·月)',
            nameTextStyle: {
                color: '#cccccc'
            },
            axisLabel: {
                color: '#cccccc',
                formatter: '¥{value}'
            },
            splitLine: {
                lineStyle: {
                    color: '#333'
                }
            }
        },
        series: [
            {
                name: '单价',
                type: 'bar',
                data: barData.values,
                showBackground: true,
                backgroundStyle: {
                    color: 'rgba(180, 180, 180, 0.1)'
                },
                itemStyle: {
                    color: function(params) {
                        const colors = ['#667eea', '#764ba2', '#f093fb'];
                        return colors[params.dataIndex];
                    },
                    borderRadius: [8, 8, 0, 0]
                },
                label: {
                    show: true,
                    position: 'top',
                    formatter: '¥{c}',
                    color: '#ffffff',
                    fontSize: 12,
                    fontWeight: 'bold'
                },
                emphasis: {
                    itemStyle: {
                        shadowBlur: 10,
                        shadowColor: 'rgba(102, 126, 234, 0.5)'
                    }
                }
            }
        ],
        backgroundColor: 'transparent'
    };

    myChart.setOption(option);

    // 响应式
    window.addEventListener('resize', function() {
        myChart.resize();
    });
}

// 渲染玫瑰图 - 朝向分布
function renderRoseChart(roseData, currentHouse) {
    const chartDom = document.getElementById('roseChart');
    const myChart = echarts.init(chartDom);

    const option = {
        tooltip: {
            trigger: 'item',
            formatter: '{b}: {c}套 ({d}%)',
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            borderColor: '#666',
            textStyle: {
                color: '#ffffff'
            }
        },
        legend: {
            orient: 'horizontal',
            bottom: '2%',
            left: 'center',
            textStyle: {
                color: '#ffffff',
                fontSize: 11
            },
            itemGap: 15
        },
        series: [
            {
                name: '朝向分布',
                type: 'pie',
                radius: [40, 110],
                center: ['50%', '42%'],
                roseType: 'area',
                itemStyle: {
                    borderRadius: 8,
                    borderColor: '#1e1e1e',
                    borderWidth: 2
                },
                data: roseData,
                color: ['#5470c6', '#91cc75', '#fac858', '#ee6666', '#73c0de', '#3ba272', '#fc8452', '#9a60b4'],
                label: {
                    show: false
                },
                labelLine: {
                    show: false
                },
                emphasis: {
                    label: {
                        show: true,
                        fontSize: 14,
                        fontWeight: 'bold',
                        color: '#ffffff'
                    },
                    itemStyle: {
                        shadowBlur: 20,
                        shadowOffsetX: 0,
                        shadowColor: 'rgba(0, 0, 0, 0.7)'
                    }
                }
            }
        ],
        backgroundColor: 'transparent'
    };

    myChart.setOption(option);

    // 响应式
    window.addEventListener('resize', function() {
        myChart.resize();
    });
}

// 渲染直方图 - 价格分布
function renderHistogramChart(histogramData, currentHouse) {
    const chartDom = document.getElementById('histogramChart');
    const myChart = echarts.init(chartDom);

    // 找到当前房源所在的价格区间索引
    const price = histogramData.current_price;
    const currentIndex = histogramData.categories.findIndex(cat => {
        if (cat === '< 2000') return price < 2000;
        if (cat === '2000-4000') return price >= 2000 && price < 4000;
        if (cat === '4000-6000') return price >= 4000 && price < 6000;
        if (cat === '6000-8000') return price >= 6000 && price < 8000;
        if (cat === '8000-10000') return price >= 8000 && price < 10000;
        if (cat === '10000-15000') return price >= 10000 && price < 15000;
        if (cat === '>= 15000') return price >= 15000;
        return false;
    });

    const option = {
        tooltip: {
            trigger: 'axis',
            axisPointer: {
                type: 'shadow',
                shadowStyle: {
                    color: 'rgba(48, 207, 208, 0.2)'
                }
            },
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            borderColor: '#30cfd0',
            borderWidth: 1,
            textStyle: {
                color: '#ffffff'
            },
            formatter: function(params) {
                if (params[0]) {
                    const isCurrent = params[0].dataIndex === currentIndex;
                    const marker = isCurrent ? '<span style="color: #ff6b6b;">★ </span>' : '';
                    return marker + params[0].name + '<br/>房源数量: ' + params[0].value + '套' +
                           (isCurrent ? '<br/><span style="color: #ff6b6b;">当前房源: ¥' + price + '</span>' : '');
                }
                return '';
            }
        },
        grid: {
            left: '8%',
            right: '4%',
            bottom: '18%',
            top: '12%',
            containLabel: false
        },
        xAxis: {
            type: 'category',
            data: histogramData.categories,
            axisLabel: {
                color: '#ffffff',
                fontSize: 10,
                fontWeight: function(value, index) {
                    return index === currentIndex ? 'bold' : 'normal';
                },
                formatter: function(value, index) {
                    // 将星标移到柱子上方，避免X轴拥挤
                    return value;
                },
                interval: 0,
                rotate: 30,
                margin: 8,
                hideOverlap: false
            },
            axisLine: {
                lineStyle: {
                    color: '#30cfd0',
                    width: 2
                }
            },
            axisTick: {
                show: false
            }
        },
        yAxis: {
            type: 'value',
            name: '房源数量',
            nameTextStyle: {
                color: '#30cfd0',
                fontSize: 12,
                padding: [0, 0, 10, 0]
            },
            axisLabel: {
                color: '#cccccc',
                formatter: '{value}套',
                fontSize: 10,
                margin: 10
            },
            minInterval: 1,
            splitNumber: 5,
            splitLine: {
                lineStyle: {
                    color: '#333',
                    type: 'dashed'
                }
            },
            axisLine: {
                show: true,
                lineStyle: {
                    color: '#444'
                }
            }
        },
        series: [
            {
                name: '房源数量',
                type: 'bar',
                data: histogramData.values.map((val, idx) => ({
                    value: val,
                    itemStyle: {
                        color: idx === currentIndex
                            ? new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: '#ff9a9e' },
                                { offset: 0.5, color: '#ff6b6b' },
                                { offset: 1, color: '#ee5a52' }
                            ])
                            : new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: '#a8edea' },
                                { offset: 0.5, color: '#30cfd0' },
                                { offset: 1, color: '#188da0' }
                            ]),
                        borderRadius: [10, 10, 0, 0],
                        shadowBlur: idx === currentIndex ? 15 : 0,
                        shadowColor: idx === currentIndex ? 'rgba(255, 107, 107, 0.5)' : 'transparent'
                    }
                })),
                barWidth: '50%',
                showBackground: true,
                backgroundStyle: {
                    color: 'rgba(180, 180, 180, 0.05)',
                    borderRadius: [10, 10, 0, 0]
                },
                label: {
                    show: true,
                    position: 'top',
                    formatter: function(params) {
                        if (params.dataIndex === currentIndex) {
                            return '{star|★} {value|' + params.value + '}';
                        }
                        return params.value;
                    },
                    rich: {
                        star: {
                            color: '#ff6b6b',
                            fontSize: 16,
                            fontWeight: 'bold'
                        },
                        value: {
                            color: '#ff6b6b',
                            fontSize: 13,
                            fontWeight: 'bold'
                        }
                    },
                    color: '#30cfd0',
                    fontSize: 11
                },
                emphasis: {
                    itemStyle: {
                        shadowBlur: 20,
                        shadowOffsetY: -5,
                        shadowColor: 'rgba(48, 207, 208, 0.6)'
                    }
                }
            }
        ],
        backgroundColor: 'transparent'
    };

    myChart.setOption(option);

    // 响应式
    window.addEventListener('resize', function() {
        myChart.resize();
    });
}

// 渲染散点图 - 面积-价格关系
function renderScatterChart(scatterData, currentHouse) {
    const chartDom = document.getElementById('scatterChart');
    const myChart = echarts.init(chartDom);

    // 准备数据：分为其他房源和当前房源
    const otherHouses = scatterData.map(item => [item.area, item.price, item.rooms]);
    const currentHouseData = [[currentHouse.area, currentHouse.price, currentHouse.rooms]];

    const option = {
        tooltip: {
            trigger: 'item',
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            borderColor: '#666',
            textStyle: {
                color: '#ffffff'
            },
            formatter: function(params) {
                const area = params.value[0];
                const price = params.value[1];
                const rooms = params.value[2];
                const unitPrice = (price / area).toFixed(2);
                const isCurrent = params.seriesName === '当前房源';
                return (isCurrent ? '<span style="color: #ff6b6b;">★ 当前房源</span><br/>' : '') +
                       '户型: ' + rooms + '<br/>' +
                       '面积: ' + area + '㎡<br/>' +
                       '价格: ¥' + price + '/月<br/>' +
                       '单价: ¥' + unitPrice + '/㎡·月';
            }
        },
        legend: {
            data: ['其他房源', '当前房源'],
            textStyle: {
                color: '#ffffff'
            },
            top: '3%',
            left: 'center'
        },
        grid: {
            left: '8%',
            right: '5%',
            bottom: '15%',
            top: '15%',
            containLabel: true
        },
        xAxis: {
            type: 'value',
            name: '面积 (㎡)',
            nameLocation: 'middle',
            nameGap: 30,
            nameTextStyle: {
                color: '#ffffff',
                fontSize: 13,
                fontWeight: 'bold'
            },
            axisLabel: {
                color: '#cccccc',
                formatter: '{value}㎡',
                fontSize: 11
            },
            splitLine: {
                show: true,
                lineStyle: {
                    color: '#333',
                    type: 'dashed'
                }
            },
            axisLine: {
                show: true,
                lineStyle: {
                    color: '#a8edea',
                    width: 2
                }
            }
        },
        yAxis: {
            type: 'value',
            name: '价格 (元/月)',
            nameLocation: 'middle',
            nameGap: 50,
            nameTextStyle: {
                color: '#ffffff',
                fontSize: 13,
                fontWeight: 'bold'
            },
            axisLabel: {
                color: '#cccccc',
                formatter: '¥{value}',
                fontSize: 11
            },
            splitLine: {
                show: true,
                lineStyle: {
                    color: '#333',
                    type: 'dashed'
                }
            },
            axisLine: {
                show: true,
                lineStyle: {
                    color: '#fed6e3',
                    width: 2
                }
            }
        },
        series: [
            {
                name: '其他房源',
                type: 'scatter',
                data: otherHouses,
                symbolSize: 8,
                itemStyle: {
                    color: new echarts.graphic.RadialGradient(0.5, 0.5, 0.8, [
                        { offset: 0, color: '#a8edea' },
                        { offset: 1, color: '#30cfd0' }
                    ]),
                    opacity: 0.7,
                    borderColor: '#30cfd0',
                    borderWidth: 1
                },
                emphasis: {
                    itemStyle: {
                        opacity: 1,
                        shadowBlur: 10,
                        shadowColor: 'rgba(48, 207, 208, 0.8)'
                    }
                }
            },
            {
                name: '当前房源',
                type: 'scatter',
                data: currentHouseData,
                symbolSize: 20,
                symbol: 'pin',
                itemStyle: {
                    color: new echarts.graphic.RadialGradient(0.5, 0.5, 0.8, [
                        { offset: 0, color: '#ff9a9e' },
                        { offset: 1, color: '#ff6b6b' }
                    ]),
                    borderColor: '#ff3333',
                    borderWidth: 2,
                    shadowBlur: 15,
                    shadowColor: 'rgba(255, 107, 107, 0.8)'
                },
                label: {
                    show: true,
                    formatter: '当前房源',
                    position: 'top',
                    color: '#ff6b6b',
                    fontSize: 12,
                    fontWeight: 'bold',
                    distance: 10
                },
                emphasis: {
                    itemStyle: {
                        shadowBlur: 20,
                        shadowColor: 'rgba(255, 107, 107, 1)'
                    }
                },
                z: 10
            }
        ],
        backgroundColor: 'transparent'
    };

    myChart.setOption(option);

    // 响应式
    window.addEventListener('resize', function() {
        myChart.resize();
    });
}

</script>

<style>
/* ========== 全局样式 ========== */
.detail-container {
    margin-top: 2rem;
    margin-bottom: 3rem;
}

/* ========== 面包屑导航优化 ========== */
.breadcrumb-container {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 1rem 0;
    margin-bottom: 0;
}

.elegant-breadcrumb {
    background: transparent;
    margin-bottom: 0;
    padding: 0;
}

.elegant-breadcrumb .breadcrumb-item a {
    color: rgba(255, 255, 255, 0.9);
    text-decoration: none;
    transition: all 0.3s ease;
    font-weight: 500;
}

.elegant-breadcrumb .breadcrumb-item a:hover {
    color: #ffffff;
    transform: translateY(-1px);
}

.elegant-breadcrumb .breadcrumb-item.active {
    color: #ffffff;
    font-weight: 600;
}

.elegant-breadcrumb .breadcrumb-item + .breadcrumb-item::before {
    content: "›";
    color: rgba(255, 255, 255, 0.7);
    font-weight: 600;
    font-size: 1.1em;
}

/* ========== 图片轮播区域 ========== */
.image-gallery-container {
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    position: relative;
}

.main-image-wrapper {
    position: relative;
    background: #f8f9fa;
}

.main-house-image {
    width: 100%;
    height: 450px;
    object-fit: cover;
    cursor: pointer;
    transition: transform 0.3s ease;
}

.main-house-image:hover {
    transform: scale(1.02);
}

.image-overlay {
    position: absolute;
    top: 15px;
    right: 15px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 8px 12px;
    border-radius: 8px;
    font-size: 0.9rem;
    backdrop-filter: blur(10px);
}

.btn-quick-view {
    position: absolute;
    bottom: 15px;
    left: 15px;
    background: rgba(255, 255, 255, 0.95);
    border: none;
    padding: 10px 16px;
    border-radius: 8px;
    font-weight: 600;
    color: #333;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
}

.btn-quick-view:hover {
    background: #f8f9fa;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

.carousel-control-prev,
.carousel-control-next {
    width: 50px;
    height: 50px;
    background: rgba(0, 0, 0, 0.5);
    border-radius: 50%;
    top: 50%;
    transform: translateY(-50%);
    backdrop-filter: blur(10px);
}

.carousel-control-prev {
    left: 15px;
}

.carousel-control-next {
    right: 15px;
}

/* ========== 房源标题和价格 ========== */
.house-header-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 15px;
    color: white;
    padding: 2rem;
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
}

.house-title-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
}

.title-wrapper {
    flex: 1;
    min-width: 300px;
}

.house-title {
    font-size: 2.2rem;
    font-weight: 700;
    margin-bottom: 1rem;
    line-height: 1.2;
}

.title-badges {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.badge-premium {
    background: linear-gradient(45deg, #e9ecef, #dee2e6);
    color: #495057;
    padding: 0.5rem 1rem;
    border-radius: 25px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.3rem;
}

.badge-type {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 25px;
    font-weight: 600;
    backdrop-filter: blur(10px);
}

.price-section {
    text-align: right;
    flex-shrink: 0;
}

.main-price {
    margin-bottom: 0.5rem;
}

.price-value {
    font-size: 3rem;
    font-weight: 800;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.price-unit {
    font-size: 1.2rem;
    font-weight: 500;
    opacity: 0.9;
}

.price-per-sqm {
    font-size: 1rem;
    opacity: 0.8;
    font-weight: 500;
}

/* ========== 信息卡片网格 ========== */
.info-cards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
}

.info-card {
    background: rgba(30, 30, 30, 0.95) !important;
    border-radius: 15px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
    overflow: hidden;
    transition: all 0.3s ease;
    border: 1px solid #444 !important;
}

.info-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
}

.info-card-header {
    padding: 1.5rem 1.5rem 1rem;
    display: flex;
    align-items: center;
    gap: 1rem;
}

.header-icon {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
}

.basic-info-card .header-icon {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
}

.location-info-card .header-icon {
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%) !important;
}

.stats-info-card .header-icon {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%) !important;
}

.header-title {
    font-size: 1.3rem;
    font-weight: 700;
    margin: 0;
    color: #ffffff !important;
}

.info-card-body {
    padding: 0 1.5rem 1.5rem;
}

.info-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.8rem 0;
    border-bottom: 1px solid #444;
}

.info-item:last-child {
    border-bottom: none;
}

.info-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #cccccc !important;
    font-weight: 500;
}

.info-label i {
    width: 16px;
    text-align: center;
    color: #667eea !important;
}

.info-value {
    font-weight: 600;
    color: #ffffff !important;
}

.info-value.highlight {
    color: #667eea !important;
    font-weight: 700;
}

.address-text {
    max-width: 200px;
    text-align: right;
    word-wrap: break-word;
}

.house-code {
    background: #f8f9fa;
    color: #667eea;
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
}

/* ========== 右侧操作卡片 ========== */
.main-action-card {
    background: rgba(30, 30, 30, 0.95) !important;
    border-radius: 20px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3) !important;
    overflow: hidden;
    border: 1px solid #444 !important;
    position: static;
}

.action-card-header {
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%) !important;
    color: white !important;
    padding: 2rem;
    text-align: center;
}

.price-highlight {
    margin-bottom: 0.5rem;
}

.price-label {
    display: block;
    font-size: 0.9rem;
    opacity: 0.9;
    margin-bottom: 0.3rem;
}

.price-amount {
    font-size: 2.5rem;
    font-weight: 800;
    display: block;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.price-subtitle {
    font-size: 0.95rem;
    opacity: 0.8;
}

.action-card-body {
    padding: 1.5rem;
}

.btn-action {
    width: 100%;
    background: rgba(44, 44, 44, 0.9) !important;
    border: 2px solid #444 !important;
    border-radius: 12px;
    padding: 1rem;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    text-decoration: none;
    color: #ffffff !important;
    transition: all 0.3s ease;
    cursor: pointer;
}

.btn-action:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3) !important;
    border-color: #667eea !important;
    background: rgba(60, 60, 60, 0.9) !important;
}

.btn-contact {
    border-color: #667eea !important;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1)) !important;
    color: #ffffff !important;
}

.btn-contact:hover {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2)) !important;
    color: #ffffff !important;
}

.btn-favorite.favorited {
    border-color: #ff6b6b !important;
    background: linear-gradient(135deg, rgba(255, 107, 107, 0.1), rgba(238, 90, 82, 0.1)) !important;
    color: #ff6b6b !important;
}

.btn-share:hover {
    border-color: #28a745;
}

.btn-icon {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.3rem;
    background: rgba(102, 126, 234, 0.1);
    color: #667eea;
    flex-shrink: 0;
}

.btn-contact .btn-icon {
    background: rgba(102, 126, 234, 0.2) !important;
    color: #667eea !important;
}

.btn-favorite.favorited .btn-icon {
    background: rgba(255, 107, 107, 0.2) !important;
    color: #ff6b6b !important;
}

.btn-content {
    text-align: left;
    flex: 1;
}

.btn-title {
    display: block;
    font-weight: 600;
    font-size: 1.1rem;
    margin-bottom: 0.2rem;
}

.btn-subtitle {
    display: block;
    font-size: 0.85rem;
    opacity: 0.7;
}

/* ========== 图表卡片样式 ========== */
#pieChartCard,
#barChartCard,
#roseChartCard,
#histogramChartCard,
#scatterChartCard {
    background: rgba(30, 30, 30, 0.95) !important;
    border: 1px solid #444 !important;
    border-radius: 20px !important;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3) !important;
    overflow: hidden;
    transition: all 0.3s ease;
}

#pieChartCard:hover,
#barChartCard:hover,
#roseChartCard:hover,
#histogramChartCard:hover,
#scatterChartCard:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4) !important;
    border-color: #667eea !important;
}

#pieChartCard .card-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
    color: white !important;
    border: none !important;
    padding: 1.5rem !important;
}

#barChartCard .card-header {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%) !important;
    color: white !important;
    border: none !important;
    padding: 1.5rem !important;
}

#roseChartCard .card-header {
    background: linear-gradient(135deg, #fa709a 0%, #fee140 100%) !important;
    color: white !important;
    border: none !important;
    padding: 1.5rem !important;
}

#histogramChartCard .card-header {
    background: linear-gradient(135deg, #30cfd0 0%, #330867 100%) !important;
    color: white !important;
    border: none !important;
    padding: 1.5rem !important;
}

#scatterChartCard .card-header {
    background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%) !important;
    color: white !important;
    border: none !important;
    padding: 1.5rem !important;
}

#pieChartCard .card-header h5,
#barChartCard .card-header h5,
#roseChartCard .card-header h5,
#histogramChartCard .card-header h5,
#scatterChartCard .card-header h5 {
    margin: 0;
    font-weight: 600;
    font-size: 1.2rem;
}

#pieChartCard .card-header small,
#barChartCard .card-header small,
#roseChartCard .card-header small,
#histogramChartCard .card-header small,
#scatterChartCard .card-header small {
    opacity: 0.9;
    font-size: 0.85rem;
}

#pieChartCard .card-body,
#barChartCard .card-body,
#roseChartCard .card-body,
#histogramChartCard .card-body,
#scatterChartCard .card-body {
    padding: 2rem;
}

.chart-title {
    color: #ffffff !important;
    font-weight: 600;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #667eea;
}

.chart-title i {
    color: #667eea;
    margin-right: 0.5rem;
}

/* ========== 推荐房源优化 ========== */
.recommendation-card {
    background: #f8f9fa;
    transition: all 0.3s ease;
    border: 1px solid #e9ecef;
    border-radius: 12px;
    overflow: hidden;
}

.recommendation-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    border-color: #667eea;
}

.recommendation-card .card-title {
    font-size: 0.95rem;
    font-weight: 600;
    color: #333;
}

.recommendation-card .btn {
    font-size: 0.85rem;
    border-radius: 8px;
    font-weight: 600;
}

/* ========== 响应式设计 ========== */
@media (max-width: 992px) {
    .house-title-section {
        flex-direction: column;
        text-align: center;
    }

    .price-section {
        text-align: center;
    }

    .info-cards-grid {
        grid-template-columns: 1fr;
    }

    .main-action-card {
        position: static;
    }
}

@media (max-width: 768px) {
    .house-title {
        font-size: 1.8rem;
    }

    .price-value {
        font-size: 2.2rem;
    }

    .btn-action {
        padding: 0.8rem;
    }

    .btn-icon {
        width: 40px;
        height: 40px;
        font-size: 1.1rem;
    }

    .main-house-image {
        height: 300px;
    }
}

/* ========== 动画效果 ========== */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.info-card,
.action-card {
    animation: fadeInUp 0.6s ease-out;
}

/* ========== 图片模态框样式 ========== */
.image-modal {
    display: none;
    position: fixed;
    z-index: 9999;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(10px);
}

.modal-content-img {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    object-fit: contain;
}

.close-modal {
    position: absolute;
    top: 20px;
    right: 35px;
    color: white;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
}

.close-modal:hover {
    color: #667eea;
}

/* ========== 设施标签样式 ========== */
.facilities .badge {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
    color: white !important;
    margin: 0.2rem !important;
    padding: 0.5rem 1rem !important;
    border-radius: 15px !important;
    font-weight: 500 !important;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2) !important;
    border: 1px solid rgba(102, 126, 234, 0.3) !important;
    transition: all 0.3s ease !important;
}

.facilities .badge:hover {
    transform: translateY(-2px) !important;
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3) !important;
}

/* ========== 配套信息样式 ========== */
.matching-info .fas {
    color: #28a745 !important;
}
</style>
{% endblock %}
